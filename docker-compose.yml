# ğŸŒŸ æ–‡è±ªåœ°å›³ã‚·ã‚¹ãƒ†ãƒ  v3.0 - æœ€æ–°ç‰ˆ
# Docker Compose è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

services:
  # ãƒ¡ã‚¤ãƒ³é–‹ç™ºã‚³ãƒ³ãƒ†ãƒŠ
  bungo-dev:
    build: .
    container_name: bungo-map-v3-dev
    volumes:
      - .:/app
      - bungo_cache:/app/cache
      # Gitè¨­å®šã®å…±æœ‰
      - ~/.gitconfig:/home/developer/.gitconfig:ro
    ports:
      - "8088:8080"  # é–‹ç™ºã‚µãƒ¼ãƒãƒ¼
      - "3001:3000"  # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã‚µãƒ¼ãƒãƒ¼
    environment:
      - BUNGO_ENV=development
      - BUNGO_DEBUG=true
      - BUNGO_LOG_LEVEL=INFO
      - PYTHONPATH=/app
    working_dir: /app
    tty: true
    stdin_open: true
    command: /bin/bash
    networks:
      - bungo-network

  # PostgreSQL ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  postgres:
    image: postgres:16-alpine
    container_name: bungo-postgres-v3
    environment:
      POSTGRES_DB: bungo_map_db
      POSTGRES_USER: bungo
      POSTGRES_PASSWORD: bungo123
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./sql:/docker-entrypoint-initdb.d
    ports:
      - "5433:5432"  # ãƒ­ãƒ¼ã‚«ãƒ«PostgreSQLã¨ã®ç«¶åˆé¿ã‘
    networks:
      - bungo-network
    profiles:
      - postgres

  # Redis ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  redis:
    image: redis:7-alpine
    container_name: bungo-redis-v3
    volumes:
      - redis_data:/data
    ports:
      - "6380:6379"  # ãƒ­ãƒ¼ã‚«ãƒ«Redisã¨ã®ç«¶åˆé¿ã‘
    networks:
      - bungo-network
    profiles:
      - redis

# ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ãƒœãƒªãƒ¥ãƒ¼ãƒ 
volumes:
  postgres_data:
  redis_data:
  bungo_cache:

# ã‚«ã‚¹ã‚¿ãƒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯
networks:
  bungo-network:
    driver: bridge