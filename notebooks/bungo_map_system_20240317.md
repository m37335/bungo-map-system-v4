# 文豪ゆかり地図システム 技術ドキュメント

## 1. 技術スタック

### バックエンド
- **Python 3.12+**: メイン開発言語
- **PostgreSQL**: メインデータベース
- **Redis**: キャッシュ層
- **SQLAlchemy**: ORM
- **Alembic**: データベースマイグレーション
- **FastAPI**: APIフレームワーク

### AI/ML
- **GPT-3.5/Claude-3**: 大規模言語モデル
- **GiNZA**: 日本語NLP
- **spaCy**: NLPフレームワーク
- **MeCab**: 形態素解析

### インフラ
- **Docker**: コンテナ化
- **Kubernetes**: オーケストレーション
- **Prometheus**: モニタリング
- **Grafana**: 可視化

## 2. 機能概要

文豪ゆかり地図システムは、青空文庫とWikipediaから文豪作品の地名情報をAI駆動で抽出し、地図上で可視化するシステムです。

### 主要機能
- 5段階地名抽出（LLM文脈理解、有名地名、市区町村、都道府県、郡）
- 自己学習型Geocoding
- 品質管理システム
- リアルタイム監視
- データエクスポート（CSV、GeoJSON）

## 3. 背景・目的

### 背景
- 文豪作品に登場する地名情報の体系的な収集・管理の必要性
- 従来の手動抽出の非効率性
- 地名の表記揺れや文脈依存性の課題

### 目的
- AIを活用した高精度な地名抽出
- 文豪作品の地理的世界の可視化
- 文学研究・観光資源としての活用

## 4. コンポーネント設計

### 4.1 コアコンポーネント
```
bungo_map/
├── core/              # コア機能
│   ├── models/       # データモデル
│   ├── database/     # データベース操作
│   └── ai/           # AI機能
├── extractors/       # 地名抽出器
├── geocoding/        # 位置情報処理
├── quality/          # 品質管理
└── cli/              # コマンドライン
```

### 4.2 データフロー
1. データ収集 → 2. AI文脈理解 → 3. 地名抽出 → 4. Geocoding → 5. 品質管理

## 5. できること・制限事項

### できること
- 文豪作品からの地名自動抽出
- 高精度な位置情報付与
- 引用文と地名の関連付け
- データの可視化とエクスポート

### 制限事項
- 処理速度: 200.5件/秒
- メモリ使用量: < 800MB
- Geocoding成功率: 89.2%
- 対応作品数: 245作品

## 6. コンポーネント使用時のオプション

### 6.1 地名抽出オプション
```python
extract_options = {
    'use_llm': True,           # LLM使用
    'confidence_threshold': 0.8, # 信頼度閾値
    'batch_size': 10,          # バッチサイズ
    'max_retries': 3           # リトライ回数
}
```

### 6.2 Geocodingオプション
```python
geocoding_options = {
    'use_cache': True,         # キャッシュ使用
    'cache_ttl': 86400,        # キャッシュ有効期限
    'retry_on_failure': True,  # 失敗時リトライ
    'timeout': 30              # タイムアウト秒
}
```

## 7. 関連ファイル・ディレクトリ構造

```
bungo_map/
├── config/           # 設定ファイル
├── data/            # データファイル
│   ├── cache/      # キャッシュ
│   ├── prompts/    # プロンプト
│   └── outputs/    # 出力
├── notebooks/       # Jupyter notebooks
├── tests/          # テスト
└── docs/           # ドキュメント
```

## 8. 注意点

### 8.1 開発時の注意点
- データベースのバックアップを定期的に取得
- 環境変数の適切な設定
- エラーハンドリングの実装
- ログの適切な記録

### 8.2 運用時の注意点
- メモリ使用量の監視
- パフォーマンスメトリクスの確認
- エラーアラートの設定
- 定期的なメンテナンス

### 8.3 セキュリティ注意点
- APIキーの適切な管理
- アクセス制御の実装
- データの暗号化
- セキュリティアップデートの適用

## 9. トラブルシューティング

### 9.1 よくある問題
1. メモリ不足
   - バッチサイズの調整
   - キャッシュの最適化

2. 処理速度低下
   - インデックスの確認
   - クエリの最適化

3. Geocoding失敗
   - キャッシュの確認
   - リトライ設定の調整

### 9.2 ログ確認方法
```bash
# アプリケーションログ
tail -f /var/log/bungo_map/app.log

# エラーログ
tail -f /var/log/bungo_map/error.log
```

## 10. 今後の展望

### 10.1 予定されている機能
- FastAPI統合REST API
- React.js統合WebUI
- 機械学習統合
- 一括統合インポート

### 10.2 改善計画
- 処理速度の向上
- 精度の向上
- UI/UXの改善
- ドキュメントの充実 