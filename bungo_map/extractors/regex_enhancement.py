#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ğŸ”§ Regexåœ°åæŠ½å‡ºè¨­å®šã®æ”¹å–„æ¡ˆ
ç¾åœ¨ã®è¨­å®šï¼ˆregex_æœ‰ååœ°å/å¸‚åŒºç”ºæ‘/éƒ½é“åºœçœŒ/éƒ¡ï¼‰ã®åˆ†æã¨å¼·åŒ–
"""

class RegexEnhancementAnalysis:
    """ç¾åœ¨ã®regexè¨­å®šã®æ”¹å–„åˆ†æ"""
    
    def __init__(self):
        self.current_performance = {
            "regex_æœ‰ååœ°å": {
                "count": 637,
                "accuracy": "é«˜ã„",
                "top_results": ["éŒå€‰(31)", "ç¥ç”°(31)", "æ±Ÿæˆ¸(31)", "æœ¬éƒ·(24)", "ä¸Šé‡(24)"],
                "strength": "æ˜ç¤ºçš„åœ°åãƒªã‚¹ãƒˆã§èª¤æŠ½å‡ºãŒå°‘ãªã„",
                "issue": "ãƒªã‚¹ãƒˆã«ãªã„åœ°åã¯æŠ½å‡ºã§ããªã„"
            },
            "regex_å¸‚åŒºç”ºæ‘": {
                "count": 384,
                "accuracy": "ä¸­ã€œé«˜",
                "pattern": r'[ä¸€-é¾¯]{2,8}[å¸‚åŒºç”ºæ‘]',
                "top_results": ["å°å·ç”º(19)", "è¥¿ç‰‡ç”º(12)", "çœŸç ‚ç”º(12)", "æ±äº¬å¸‚(12)"],
                "strength": "é©åº¦ãªé•·ã•åˆ¶é™ã§å“è³ªç¢ºä¿",
                "issue": "å¢ƒç•Œæ¡ä»¶ãŒä¸ååˆ†ï¼ˆå‰å¾Œã®æ–‡å­—ãƒã‚§ãƒƒã‚¯ãªã—ï¼‰"
            },
            "regex_éƒ½é“åºœçœŒ": {
                "count": 61,
                "accuracy": "éå¸¸ã«é«˜ã„",
                "strength": "æ˜ç¢ºãªãƒ‘ã‚¿ãƒ¼ãƒ³ã§èª¤æŠ½å‡ºã»ã¼ãªã—",
                "issue": "ç‰¹ã«ãªã—"
            },
            "regex_éƒ¡": {
                "count": 18,
                "accuracy": "ä¸­",
                "pattern": r'[ä¸€-é¾¯]{2,6}[éƒ¡]',
                "strength": "éƒ¡ãƒ¬ãƒ™ãƒ«ã®åœ°åã‚‚æ•æ‰",
                "issue": "ä½¿ç”¨é »åº¦ãŒä½ã„"
            }
        }
    
    def get_enhancement_recommendations(self):
        """æ”¹å–„æ¨å¥¨äº‹é …"""
        return {
            "immediate_improvements": [
                {
                    "target": "regex_å¸‚åŒºç”ºæ‘",
                    "enhancement": "å¢ƒç•Œæ¡ä»¶è¿½åŠ ",
                    "new_pattern": r'(?<![ä¸€-é¾¯])[ä¸€-é¾¯]{2,6}[å¸‚åŒºç”ºæ‘](?![ä¸€-é¾¯])',
                    "benefit": "è¤‡åˆèªã§ã®èª¤æŠ½å‡ºé˜²æ­¢"
                },
                {
                    "target": "regex_éƒ¡",
                    "enhancement": "é•·ã•åˆ¶é™å¼·åŒ–",
                    "new_pattern": r'(?<![ä¸€-é¾¯])[ä¸€-é¾¯]{2,4}[éƒ¡](?![ä¸€-é¾¯])',
                    "benefit": "å“è³ªå‘ä¸Š"
                }
            ],
            
            "additional_patterns": [
                {
                    "name": "regex_å¤å…¸åœ°å",
                    "pattern": r'(?:å¹³å®‰äº¬|æ±Ÿæˆ¸|æ­¦è”µ|ç›¸æ¨¡|ç”²æ–|ä¿¡æ¿ƒ|è¶Šå¾Œ|ä¸‹é‡|ä¸Šé‡|é§¿æ²³|ä¼Šè±†|ä¼Šå‹¢|å±±åŸ|å¤§å’Œ|æ²³å†…|å’Œæ³‰|æ‘‚æ´¥|è¿‘æ±Ÿ|ç¾æ¿ƒ|å°¾å¼µ|è–©æ‘©|åœŸä½|é™¸å¥¥|å‡ºç¾½)',
                    "benefit": "æ–‡å­¦ä½œå“ç‰¹æœ‰ã®å¤å…¸åœ°åã‚’é«˜ç²¾åº¦ã§æŠ½å‡º"
                },
                {
                    "name": "regex_è‡ªç„¶åœ°å½¢",
                    "pattern": r'(?<![ä¸€-é¾¯])[ä¸€-é¾¯]{2,4}[å±±å·æ¹–æµ·](?![ä¸€-é¾¯])',
                    "benefit": "è‡ªç„¶åœ°åã®ä½“ç³»çš„æŠ½å‡º"
                },
                {
                    "name": "regex_å¯ºç¤¾",
                    "pattern": r'(?<![ä¸€-é¾¯])[ä¸€-é¾¯]{2,4}[å¯ºé™¢ç¥ç¤¾å®®](?![ä¸€-é¾¯])',
                    "benefit": "å®—æ•™æ–½è¨­ã®åœ°åæŠ½å‡º"
                }
            ],
            
            "anti_patterns": [
                {
                    "name": "æ–¹å‘èªé™¤å¤–",
                    "pattern": r'(?<![ä¸€-é¾¯])[æ±è¥¿å—åŒ—](?=ã‹ã‚‰|ã¸|ã«å‘ã‹ã£ã¦)',
                    "purpose": "ã€Œæ±ã‹ã‚‰è¥¿ã¸ã€ã®ã‚ˆã†ãªæ–¹å‘èªã‚’é™¤å¤–"
                },
                {
                    "name": "æ¤ç‰©åé™¤å¤–", 
                    "pattern": r'(?<![ä¸€-é¾¯])[è©æ¡œæ¢…æ¾ç«¹](?=[ãŒã®](?:å’²ã|æ•£ã‚‹|èŒ‚ã‚‹|å»¶ã³ã‚‹))',
                    "purpose": "ã€Œè©ãŒèŒ‚ã‚‹ã€ã®ã‚ˆã†ãªæ¤ç‰©åã‚’é™¤å¤–"
                }
            ]
        }
    
    def analyze_problematic_cases(self):
        """å•é¡Œã‚±ãƒ¼ã‚¹ã®åˆ†æ"""
        return {
            "ginza_nlp_issues": {
                "è©": {
                    "issue": "æ¤ç‰©åã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã®ã«åœ°åã¨ã—ã¦æŠ½å‡º",
                    "context": "å¤§ããªè©ãŒäººã®èƒŒã‚ˆã‚Šé«˜ãå»¶ã³ã¦",
                    "solution": "æ–‡è„ˆåˆ†æã§æ¤ç‰©ç”¨æ³•ã‚’æ¤œå‡º"
                },
                "æŸ": {
                    "issue": "å¯ºé™¢åã®ä¸€éƒ¨ãªã®ã«åœ°åã¨ã—ã¦æŠ½å‡º",
                    "context": "é«˜æŸå¯ºã®äº”é‡ã®å¡”",
                    "solution": "ã€Œã€œå¯ºã€ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã®é™¤å¤–"
                },
                "æ±": {
                    "issue": "æ–¹å‘ã‚’ç¤ºã™ã®ã«åœ°åã¨ã—ã¦æŠ½å‡º",
                    "context": "æ±ã‹ã‚‰è¥¿ã¸è²«ã„ãŸå»Šä¸‹",
                    "solution": "æ–¹å‘ç”¨æ³•ã®æ–‡è„ˆåˆ†æ"
                },
                "éƒ½": {
                    "issue": "ä¸€èˆ¬åè©ãªã®ã«åœ°åã¨ã—ã¦æŠ½å‡º",
                    "context": "éƒ½ã®ã¾ã‚“ä¸­ã«ç«‹ã£ã¦",
                    "solution": "ç‰¹å®šã®åŠ©è©ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã®é™¤å¤–"
                }
            },
            "regex_performance": {
                "status": "è‰¯å¥½",
                "reason": "ä¸Šè¨˜å•é¡Œã‚±ãƒ¼ã‚¹ã¯regexç³»ã§ã¯æŠ½å‡ºã•ã‚Œã¦ã„ãªã„",
                "strength": "æ˜ç¤ºçš„ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚Šèª¤æŠ½å‡ºã‚’å›é¿"
            }
        }
    
    def get_best_practices(self):
        """ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹"""
        return {
            "pattern_design": [
                "æ˜ç¤ºçš„åœ°åãƒªã‚¹ãƒˆï¼ˆregex_æœ‰ååœ°åæ–¹å¼ï¼‰ãŒæœ€ã‚‚ç²¾åº¦ãŒé«˜ã„",
                "å¢ƒç•Œæ¡ä»¶ï¼ˆå‰å¾Œã®æ–‡å­—ãƒã‚§ãƒƒã‚¯ï¼‰ã¯å¿…é ˆ",
                "é•·ã•åˆ¶é™ã§å“è³ªã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆ2-6æ–‡å­—æ¨å¥¨ï¼‰",
                "ã‚«ãƒ†ã‚´ãƒªåˆ¥ã®ä¿¡é ¼åº¦è¨­å®šã§å„ªå…ˆé †ä½ä»˜ã‘"
            ],
            
            "confidence_settings": {
                "regex_éƒ½é“åºœçœŒ": 0.95,  # æœ€é«˜ç²¾åº¦
                "regex_å¤å…¸åœ°å": 0.92,  # æ–‡å­¦çš„é‡è¦æ€§
                "regex_æœ‰ååœ°å": 0.90,  # æ˜ç¤ºçš„ãƒªã‚¹ãƒˆ
                "regex_å¸‚åŒºç”ºæ‘": 0.85,  # ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ™ãƒ¼ã‚¹
                "regex_è‡ªç„¶åœ°å½¢": 0.80,  # åœ°å½¢å
                "regex_éƒ¡": 0.75,       # ä½¿ç”¨é »åº¦ä½
                "regex_å¯ºç¤¾": 0.70      # æ–½è¨­å
            },
            
            "hybrid_approach": [
                "regexï¼ˆé«˜ç²¾åº¦ï¼‰+ ginza_nlpï¼ˆé«˜ç¶²ç¾…æ€§ï¼‰+ AIæ–‡è„ˆåˆ†æï¼ˆèª¤æŠ½å‡ºé™¤å»ï¼‰",
                "æ®µéšçš„ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼šregex â†’ ginza â†’ context_analysis",
                "å„æ‰‹æ³•ã®å¼·ã¿ã‚’æ´»ã‹ã—ãŸçµ„ã¿åˆã‚ã›"
            ]
        }

# å®Ÿè£…ä¾‹
def get_enhanced_regex_patterns():
    """å¼·åŒ–ã•ã‚ŒãŸregexãƒ‘ã‚¿ãƒ¼ãƒ³ã‚»ãƒƒãƒˆ"""
    return {
        # ç¾åœ¨ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ”¹è‰¯ç‰ˆ
        "éƒ½é“åºœçœŒ_å¼·åŒ–": {
            "pattern": r'(?<![ä¸€-é¾¯])[åŒ—æµ·é’æ£®å²©æ‰‹å®®åŸç§‹ç”°å±±å½¢ç¦å³¶èŒ¨åŸæ ƒæœ¨ç¾¤é¦¬åŸ¼ç‰åƒè‘‰æ±äº¬ç¥å¥ˆå·æ–°æ½Ÿå¯Œå±±çŸ³å·ç¦äº•å±±æ¢¨é•·é‡å²é˜œé™å²¡æ„›çŸ¥ä¸‰é‡æ»‹è³€äº¬éƒ½å¤§é˜ªå…µåº«å¥ˆè‰¯å’Œæ­Œå±±é³¥å–å³¶æ ¹å²¡å±±åºƒå³¶å±±å£å¾³å³¶é¦™å·æ„›åª›é«˜çŸ¥ç¦å²¡ä½è³€é•·å´ç†Šæœ¬å¤§åˆ†å®®å´é¹¿å…å³¶æ²–ç¸„][éƒ½é“åºœçœŒ](?![ä¸€-é¾¯])',
            "confidence": 0.95
        },
        
        "å¸‚åŒºç”ºæ‘_å¼·åŒ–": {
            "pattern": r'(?<![ä¸€-é¾¯])[ä¸€-é¾¯]{2,6}[å¸‚åŒºç”ºæ‘](?![ä¸€-é¾¯])',
            "confidence": 0.85
        },
        
        # æ–°è¦ãƒ‘ã‚¿ãƒ¼ãƒ³
        "å¤å…¸åœ°å": {
            "pattern": r'(?:å¹³å®‰äº¬|æ±Ÿæˆ¸|æ­¦è”µ|ç›¸æ¨¡|ç”²æ–|ä¿¡æ¿ƒ|è¶Šå¾Œ|ä¸‹é‡|ä¸Šé‡|é§¿æ²³|ä¼Šè±†|ä¼Šå‹¢|å±±åŸ|å¤§å’Œ|æ²³å†…|å’Œæ³‰|æ‘‚æ´¥|è¿‘æ±Ÿ|ç¾æ¿ƒ|å°¾å¼µ|è–©æ‘©|åœŸä½|é™¸å¥¥|å‡ºç¾½)',
            "confidence": 0.92
        },
        
        "è‡ªç„¶åœ°å½¢": {
            "pattern": r'(?<![ä¸€-é¾¯])[ä¸€-é¾¯]{2,4}[å±±å·æ¹–æµ·å³ è°·é‡åŸå³¶å²¬æµ¦å´](?![ä¸€-é¾¯])',
            "confidence": 0.80
        }
    } 